<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forgot Password ‚Äî MusicApp</title>
  <link rel="stylesheet" href="shared.css" />
  <style>
    .step { display: none; }
    .step.active { display: block; }
    .back-link {
      display: inline-flex; align-items: center; gap: 6px;
      color: var(--muted); font-size: 14px; text-decoration: none;
      margin-bottom: 28px;
    }
    .back-link:hover { color: var(--text); }
    .success-icon {
      font-size: 56px; text-align: center; margin-bottom: 20px;
    }
    .check-email-title {
      font-family: var(--font-display);
      font-size: 26px; font-weight: 800;
      margin-bottom: 10px;
    }
    .check-email-sub { color: var(--muted); font-size: 14px; margin-bottom: 28px; }
    .email-highlight {
      color: var(--accent); font-weight: 600;
    }
    .tip-box {
      background: rgba(124,58,237,0.08);
      border: 1px solid rgba(124,58,237,0.2);
      border-radius: var(--radius-sm);
      padding: 14px 16px;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 20px;
    }
    .tip-box strong { color: var(--text); }
  </style>
</head>
<body>
<div class="auth-wrapper">
  <div class="auth-card">

    <!-- STEP 1: Enter Email -->
    <div class="step active" id="step1">
      <a href="login.html" class="back-link">‚Üê Back to Login</a>

      <div class="auth-logo">üéµ Music<span>App</span></div>
      <p class="auth-subtitle">Enter your email and we'll send you a link to reset your password.</p>

      <div class="alert alert-error"   id="err1"></div>
      <div class="alert alert-success" id="suc1"></div>

      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="email" placeholder="you@example.com" />
      </div>

      <button class="btn btn-primary" id="submitBtn" onclick="doForgot()">
        <span id="submitText">Send Reset Link</span>
        <div class="spinner" id="submitSpinner"></div>
      </button>

      <div class="link-row">Remember your password? <a href="login.html">Sign in</a></div>
    </div>

    <!-- STEP 2: Check Email -->
    <div class="step" id="step2">
      <div class="success-icon">üì¨</div>
      <div class="check-email-title">Check your inbox</div>
      <p class="check-email-sub">
        We sent a password reset link to<br />
        <span class="email-highlight" id="sentTo"></span>
      </p>

      <div class="tip-box">
        <strong>Tip:</strong> The link expires in <strong>1 hour</strong>. 
        If you don't see the email, check your spam or junk folder.
      </div>

      <button class="btn btn-secondary" onclick="goBack()" style="width:100%;margin-bottom:12px;">
        ‚Üê Try a different email
      </button>

      <div class="link-row">
        Remembered your password? <a href="login.html">Sign in</a>
      </div>
    </div>

  </div>
</div>

<script src="config.js"></script>
<script>
  if (localStorage.getItem('token')) window.location.href = 'play.html';

  function showErr(msg) {
    const el = document.getElementById('err1');
    el.textContent = msg; el.style.display = 'block';
  }
  function hideErr() { document.getElementById('err1').style.display = 'none'; }

  function setLoading(loading) {
    document.getElementById('submitText').style.display    = loading ? 'none' : 'inline';
    document.getElementById('submitSpinner').style.display = loading ? 'block' : 'none';
    document.getElementById('submitBtn').disabled          = loading;
  }

  async function doForgot() {
    hideErr();
    const email = document.getElementById('email').value.trim();
    if (!email) return showErr('Please enter your email address.');

    setLoading(true);
    try {
      await api.post('/auth/forgot-password', { email }, false);
      document.getElementById('sentTo').textContent = email;
      document.getElementById('step1').classList.remove('active');
      document.getElementById('step2').classList.add('active');
    } catch (e) {
      showErr(e.error || 'Something went wrong. Please try again.');
    } finally {
      setLoading(false);
    }
  }

  function goBack() {
    document.getElementById('step2').classList.remove('active');
    document.getElementById('step1').classList.add('active');
  }

  // Submit on Enter
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && document.getElementById('step1').classList.contains('active')) {
      doForgot();
    }
  });
</script>
</body>
</html>