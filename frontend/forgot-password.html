<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forgot Password ‚Äî ListenMe</title>
  <link rel="stylesheet" href="shared.css" />
  <style>
    .icon-wrap {
      width: 72px; height: 72px; border-radius: 50%;
      background: rgba(124,58,237,0.12);
      border: 1px solid rgba(124,58,237,0.25);
      display: flex; align-items: center; justify-content: center;
      font-size: 32px; margin: 0 auto 24px; position: relative;
      animation: iconPop 0.5s 0.2s cubic-bezier(0.16,1,0.3,1) both;
    }
    @keyframes iconPop {
      from { opacity:0; transform:scale(0.5) rotate(-15deg); }
      to   { opacity:1; transform:scale(1)   rotate(0deg);   }
    }
    .icon-wrap::after {
      content:''; position:absolute; inset:-6px; border-radius:50%;
      border:2px solid rgba(124,58,237,0.2);
      animation: pulseRing 2s ease-out infinite;
    }
    @keyframes pulseRing {
      0%   { transform:scale(1);   opacity:1; }
      100% { transform:scale(1.3); opacity:0; }
    }
    .success-title {
      font-family:var(--font-display);
      font-size:24px; font-weight:800; margin-bottom:8px; text-align:center;
    }
    .success-sub { color:var(--muted); font-size:14px; margin-bottom:24px; text-align:center; line-height:1.7; }
    .email-highlight { color:var(--accent); font-weight:600; }
    .tip-box {
      background:rgba(124,58,237,0.07);
      border:1px solid rgba(124,58,237,0.18);
      border-radius:var(--radius-sm);
      padding:14px 16px; font-size:13px;
      color:var(--muted); margin-bottom:20px;
    }
    .tip-box strong { color:var(--text); }
  </style>
</head>
<body>
<div class="auth-wrapper">
  <div class="auth-card">

    <!-- STEP 1: Enter Email -->
    <div class="step active" id="step1">
      <a href="login.html" class="back-link">‚Üê Back to Login</a>
      <div class="icon-wrap">üîë</div>
      <div class="auth-logo" style="text-align:center;">Forgot <span>Password?</span></div>
      <p class="auth-subtitle" style="text-align:center;">
        Enter your email and we'll send you a reset link.
      </p>
      <div class="alert alert-error" id="err1"></div>
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="email" placeholder="you@example.com" />
      </div>
      <button class="btn btn-primary" id="submitBtn" onclick="doForgot()">
        <span id="submitText">Send Reset Link</span>
        <div class="spinner" id="submitSpinner"></div>
      </button>
      <div class="link-row">Remember your password? <a href="login.html">Sign in</a></div>
    </div>

    <!-- STEP 2: Success -->
    <div class="step" id="step2">
      <div class="icon-wrap" style="background:rgba(34,197,94,0.1);border-color:rgba(34,197,94,0.25);">üì¨</div>
      <div class="success-title">Check your inbox!</div>
      <p class="success-sub">
        We sent a reset link to<br/>
        <span class="email-highlight" id="sentTo"></span>
      </p>
      <div class="tip-box">
        <strong>‚è± Link expires in 1 hour.</strong><br/>
        Can't find it? Check your spam or junk folder.
      </div>
      <button class="btn btn-secondary" onclick="goBack()" style="width:100%;margin-bottom:12px;">
        ‚Üê Try a different email
      </button>
      <div class="link-row">Remembered it? <a href="login.html">Sign in</a></div>
    </div>

  </div>
</div>
<script src="config.js"></script>
<script>
  if (localStorage.getItem('token')) window.location.href = 'play.html';

  function showErr(msg) {
    const el = document.getElementById('err1');
    el.textContent = msg; el.style.display = 'block';
  }
  function setLoading(on) {
    document.getElementById('submitText').style.display    = on ? 'none' : 'inline';
    document.getElementById('submitSpinner').style.display = on ? 'block' : 'none';
    document.getElementById('submitBtn').disabled          = on;
  }

  async function doForgot() {
    document.getElementById('err1').style.display = 'none';
    const email = document.getElementById('email').value.trim();
    if (!email) return showErr('Please enter your email address.');
    setLoading(true);
    try {
      await api.post('/auth/forgot-password', { email }, false);
      document.getElementById('sentTo').textContent = email;
      document.getElementById('step1').classList.remove('active');
      document.getElementById('step2').classList.add('active');
    } catch (e) {
      showErr(e.error || 'Something went wrong. Please try again.');
    } finally {
      setLoading(false);
    }
  }

  function goBack() {
    document.getElementById('step2').classList.remove('active');
    document.getElementById('step1').classList.add('active');
  }

  document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && document.getElementById('step1').classList.contains('active')) doForgot();
  });
</script>
</body>
</html>